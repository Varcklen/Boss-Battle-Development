{
  "Id": 50333705,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope OverloadArena initializer init\r\n\r\n    globals\r\n        public constant integer GOLD_INITIAL_FIRST = 60\r\n        public constant integer GOLD_INITIAL_SECOND = 120\r\n        public constant integer GOLD_EXTRA_PER_KILL = 5\r\n        public constant integer GOLD_CAP = 130\r\n        \r\n        private constant integer CENTER_SPAWN_ABILITY = 'A1EX'\r\n        \r\n        private unit temp_Boss\r\n    endglobals\r\n\r\n\tprivate function AggroStart takes nothing returns nothing\r\n\t\tlocal integer id = GetHandleId( GetExpiredTimer() )\r\n\t\tlocal unit boss = LoadUnitHandle(udg_hash, id, StringHash(\"aggro_delay\") )\r\n\t\t\r\n\t\tcall aggro(boss)\r\n\t\tcall FlushChildHashtable( udg_hash, id )\r\n\t\t\r\n\t\tset boss = null\r\n\tendfunction\r\n\t\r\n    private function AL_BossSpawn takes integer bossId, timer timerUsed returns nothing\r\n    \tlocal unit boss\r\n        local integer rand = GetRandomInt( 1, 4 )\r\n\r\n        set boss = CreateUnit(Player(10), bossId, GetLocationX( udg_point[rand + 13] ), GetLocationY( udg_point[rand + 13] ), 270 )\r\n        \r\n        if GetUnitAbilityLevel( boss, CENTER_SPAWN_ABILITY ) > 0 then\r\n        \tcall SetUnitPosition( boss, GetRectCenterX( udg_Boss_Rect ), GetRectCenterX( udg_Boss_Rect ) )\r\n        endif\r\n        \r\n        call DestroyEffect( AddSpecialEffectTarget( \"Abilities\\\\Spells\\\\Orc\\\\FeralSpirit\\\\feralspirittarget.mdl\", boss, \"origin\" ) )\r\n        call PingMinimapForForceEx( bj_FORCE_ALL_PLAYERS, GetUnitX( boss ), GetUnitY( boss ), 5, bj_MINIMAPPINGSTYLE_ATTACK, 100, 50, 50 )\r\n        \r\n        if GetUnitTypeId(boss) == 'n00F' then\r\n            set udg_logic[72] = true\r\n            call TriggerExecute( gg_trg_BossDamage )\r\n            call ExtraArenaGeneral_RemovePortals()\r\n            call DestroyTimer( timerUsed )\r\n        endif\r\n\r\n        call InvokeTimerWithUnit( boss, \"aggro_delay\", 0.05, false, function AggroStart )\r\n\r\n        set boss = null\r\n    endfunction\r\n\r\n\tprivate function Tick takes timer timerUsed returns nothing\r\n\t\tlocal integer id = GetHandleId( timerUsed )\r\n\t\tlocal integer bossLevel = LoadInteger( udg_hash, id, StringHash( \"LAlvl\" ) )\r\n\t\tlocal integer bossIndex = LoadInteger( udg_hash, id, StringHash( \"LA\" ) ) + 1\r\n        local integer bossId = DB_Boss_id[bossLevel][bossIndex]\r\n        local boolean loopL = false\r\n        \r\n        loop\r\n            exitwhen loopL or bossLevel > 10\r\n            if bossId != 0 and CountUnitsInGroup(GetUnitsOfTypeIdAll(bossId)) == 0 then\r\n            \tcall SaveInteger( udg_hash, id, StringHash( \"LAlvl\" ), bossLevel )\r\n        \t\tcall SaveInteger( udg_hash, id, StringHash( \"LA\" ), bossIndex )\r\n                call AL_BossSpawn(bossId, timerUsed)\r\n                set loopL = true\r\n            elseif bossId == 0 then \r\n                set bossLevel = bossLevel + 1\r\n                set bossIndex = 1\r\n                set bossId = DB_Boss_id[bossLevel][bossIndex]\r\n            else\r\n                set loopL = true\r\n                call DestroyTimer( timerUsed )\r\n            endif\r\n        endloop\r\n        \r\n        call ExtraArenaGeneral_CreateRunes()\r\n    endfunction\r\n    \r\n    private function LA_StartSpawn takes nothing returns nothing\r\n        if udg_fightmod[4] == false then\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n        \tcall Tick(GetExpiredTimer())\r\n        endif\r\n    endfunction\r\n\r\n    function Trig_AL_StartWork_Actions takes nothing returns nothing\r\n        local integer cyclA = 1\r\n        local integer id\r\n        local integer bid\r\n\r\n        set udg_Boss_Rect = gg_rct_RandomItem\r\n        set udg_Boss_BigRect = gg_rct_Vision3\r\n        set udg_fightmod[4] = true\r\n        set udg_ArenaLim[1] = udg_ArenaLim[1] + 1\r\n        set udg_logic[31] = true\r\n        call FightStart()\r\n        call MultiSetColor( udg_multi, 5, 2, 0.00, 0.00, 0.00, 100.00 )\r\n        \r\n        call EnableTrigger( gg_trg_IA_TPBattle )\r\n        call EnableTrigger( gg_trg_BossDamage )\r\n        call OverlordArenaDeath_Enable()\r\n        \r\n        call ExtraArenaGeneral_MoveHeroesIntoArena()\r\n        \r\n        if udg_Arena_LvL[1] == 0 then\r\n            set udg_number[9] = GOLD_INITIAL_FIRST\r\n            call DisplayTimedTextToForce( GetPlayersAll(), 15, \"|cffffcc00'Overlord Arena'|r - an arena in which bosses constantly appear. For each defeated boss you will receive gold.\" )\r\n            call DisplayTimedTextToForce( GetPlayersAll(), 15, \"|cffffcc00Death in this arena will not bring defeat.|r\")\r\n        else\r\n            set udg_number[9] = GOLD_INITIAL_SECOND\r\n        endif\r\n        \r\n        set id = GetHandleId( udg_UNIT_CUTE_BOB )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"ALsp\" ) ) == null  then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"ALsp\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"ALsp\" ) ) ) \r\n        if udg_Arena_LvL[1] == 1 then\r\n            set bid = 'e004'\r\n            call SaveInteger( udg_hash, id, StringHash( \"LAlvl\" ), 4 )\r\n        else\r\n            set bid = 'n005'\r\n            call SaveInteger( udg_hash, id, StringHash( \"LAlvl\" ), 1 )\r\n        endif\r\n        call SaveInteger( udg_hash, id, StringHash( \"LA\" ), 1 )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( udg_UNIT_CUTE_BOB ), StringHash( \"ALsp\" ) ), 15, true, function LA_StartSpawn )\r\n        \r\n        call AL_BossSpawn(bid, null)\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        set gg_trg_AL_StartWork = CreateTrigger(  )\r\n        call TriggerAddAction( gg_trg_AL_StartWork, function Trig_AL_StartWork_Actions )\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}