{
  "Id": 50333255,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "globals \r\n    constant real PYROLORD_R_DAMAGE = 35\r\n    constant integer PYROLORD_R_KILL_CONDITION = 6\r\nendglobals\r\n\r\nfunction Trig_PyrolordR_Conditions takes nothing returns boolean\r\n    return GetSpellAbilityId() == 'A0NM'\r\nendfunction\r\n\r\nfunction PyrolordRCool takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer() )\r\n    local unit u = LoadUnitHandle( udg_hash, id, StringHash( \"prlrc\" ) )\r\n    local integer sk = LoadInteger( udg_hash, id, StringHash( \"prlrc\" ) )\r\n    local integer lvl = LoadInteger( udg_hash, id, StringHash( \"prlrlvl\" ) )\r\n\r\n    call BlzStartUnitAbilityCooldown( u, sk, 5 )\r\n    call SetUnitState( u, UNIT_STATE_MANA, GetUnitState( u, UNIT_STATE_MANA ) + BlzGetAbilityManaCost( sk, lvl-1 ) )\r\n    call FlushChildHashtable( udg_hash, id )\r\n\r\n    set u = null\r\nendfunction  \r\n\r\nfunction PyrolordRCast takes nothing returns nothing\r\n    local integer id = GetHandleId( GetExpiredTimer( ) )\r\n    local unit dummy = LoadUnitHandle( udg_hash, id, StringHash( \"prlr\" ) )\r\n    local unit target = LoadUnitHandle( udg_hash, id, StringHash( \"prlrt\" ) )\r\n    local real dmg = LoadReal( udg_hash, id, StringHash( \"prlr\" ) )\r\n    \r\n    if GetUnitState( target, UNIT_STATE_LIFE) > 0.405 then\r\n        if DistanceBetweenUnits(target, dummy) < 50 then\r\n            call DestroyEffect( AddSpecialEffect(\"Abilities\\\\Spells\\\\Other\\\\Incinerate\\\\FireLordDeathExplode.mdl\", GetUnitX(target), GetUnitY(target)) )\r\n            call UnitDamageTarget(dummy, target, dmg, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)\r\n            call RemoveUnit( dummy )\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        else\r\n            call IssuePointOrder( dummy, \"move\", GetUnitX( target ), GetUnitY( target ) )\r\n        endif\r\n    elseif GetUnitState( dummy, UNIT_STATE_LIFE) > 0.405 and GetUnitState( target, UNIT_STATE_LIFE) <= 0.405 then\r\n        set target = randomtarget( dummy, 1200, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        if target != null then\r\n            call IssuePointOrderLoc( dummy, \"move\", GetUnitLoc( target ) )\r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"prlrt\" ), target )\r\n        else\r\n            call DestroyEffect( AddSpecialEffect(\"Abilities\\\\Spells\\\\Other\\\\Incinerate\\\\FireLordDeathExplode.mdl\", GetUnitX(dummy), GetUnitY(dummy)) )\r\n            call RemoveUnit( dummy )\r\n            call FlushChildHashtable( udg_hash, id )\r\n            call DestroyTimer( GetExpiredTimer() )\r\n        endif\r\n    elseif GetUnitState( dummy, UNIT_STATE_LIFE) <= 0.405 then\r\n        call RemoveUnit( dummy )\r\n        call FlushChildHashtable( udg_hash, id )\r\n        call DestroyTimer( GetExpiredTimer() )\r\n    endif\r\n    \r\n    set target = null\r\n    set dummy = null\r\nendfunction\r\n\r\nfunction Trig_PyrolordR_Actions takes nothing returns nothing\r\n    local unit caster\r\n    local integer lvl\r\n    local real dmg\r\n    local integer arrows\r\n    local integer cyclA\r\n    local integer id\r\n    local unit t\r\n    local real rand\r\n    local integer bonus\r\n    local boolean isEnemyFound = false\r\n    \r\n    if CastLogic() then\r\n        set caster = udg_Caster\r\n        set lvl = udg_Level\r\n    elseif RandomLogic() then\r\n        set caster = udg_Caster\r\n        set lvl = udg_Level\r\n        call textst( udg_string[0] + GetObjectName('A0NM'), caster, 64, 90, 10, 1.5 )\r\n    else\r\n        set caster = GetSpellAbilityUnit()\r\n        set lvl = GetUnitAbilityLevel(GetSpellAbilityUnit(), GetSpellAbilityId())\r\n    endif\r\n    \r\n    set bonus = R2I(LoadInteger( udg_hash, GetHandleId( caster ), StringHash( \"killb\" ))/PYROLORD_R_KILL_CONDITION)\r\n    \r\n    set dmg = (PyrolordExtraDamage + PYROLORD_R_DAMAGE) * GetUnitSpellPower(caster)\r\n    set arrows = bonus + lvl + 2\r\n    \r\n    set cyclA = 1\r\n    loop\r\n        exitwhen cyclA > arrows\r\n        set t = randomtarget( caster, 1200, \"enemy\", \"\", \"\", \"\", \"\" )\r\n        if t != null then\r\n            set isEnemyFound = true\r\n            call dummyspawn( caster, 0, 'A017', 'A0N5', 0 )\r\n            call SetUnitMoveSpeed( bj_lastCreatedUnit, GetRandomReal( 300, 500 ) )\r\n            set rand = GetRandomReal( 0.5, 2 )\r\n            call SetUnitScale( bj_lastCreatedUnit, rand, rand, rand )\r\n            \r\n            call IssuePointOrder( bj_lastCreatedUnit, \"move\", GetUnitX( t ), GetUnitY( t ) )\r\n            \r\n            set id = GetHandleId( bj_lastCreatedUnit )\r\n            if LoadTimerHandle( udg_hash, id, StringHash( \"prlr\" ) ) == null then\r\n                call SaveTimerHandle( udg_hash, id, StringHash( \"prlr\" ), CreateTimer() )\r\n            endif\r\n            set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"prlr\" ) ) ) \r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"prlr\" ), bj_lastCreatedUnit )\r\n            call SaveUnitHandle( udg_hash, id, StringHash( \"prlrt\" ), t )\r\n            call SaveReal( udg_hash, id, StringHash( \"prlr\" ), dmg )\r\n            call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( bj_lastCreatedUnit ), StringHash( \"prlr\" ) ), 0.2, true, function PyrolordRCast )\r\n        endif\r\n        set cyclA = cyclA + 1\r\n    endloop\r\n    \r\n    if isEnemyFound == false and GetSpellAbilityId() == 'A0NM' then\r\n        call textst( \"|c00909090 No enemies found\", caster, 64, 90, 10, 1 )\r\n        \r\n        set id = GetHandleId( caster )\r\n        if LoadTimerHandle( udg_hash, id, StringHash( \"prlrc\" ) ) == null then\r\n            call SaveTimerHandle( udg_hash, id, StringHash( \"prlrc\" ), CreateTimer() )\r\n        endif\r\n        set id = GetHandleId( LoadTimerHandle( udg_hash, id, StringHash( \"prlrc\" ) ) ) \r\n        call SaveUnitHandle( udg_hash, id, StringHash( \"prlrc\" ), caster )\r\n        call SaveInteger( udg_hash, id, StringHash( \"prlrc\" ), GetSpellAbilityId() )\r\n        call SaveInteger( udg_hash, id, StringHash( \"prlrlvl\" ), lvl )\r\n        call TimerStart( LoadTimerHandle( udg_hash, GetHandleId( caster ), StringHash( \"prlrc\" ) ), 0.01, false, function PyrolordRCool )\r\n    endif\r\n    \r\n    set caster = null\r\n    set t = null\r\nendfunction\r\n\r\n//===========================================================================\r\nfunction InitTrig_PyrolordR takes nothing returns nothing\r\n    set gg_trg_PyrolordR = CreateTrigger(  )\r\n    call TriggerRegisterAnyUnitEventBJ( gg_trg_PyrolordR, EVENT_PLAYER_UNIT_SPELL_EFFECT )\r\n    call TriggerAddCondition( gg_trg_PyrolordR, Condition( function Trig_PyrolordR_Conditions ) )\r\n    call TriggerAddAction( gg_trg_PyrolordR, function Trig_PyrolordR_Actions )\r\nendfunction\r\n\r\n",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}