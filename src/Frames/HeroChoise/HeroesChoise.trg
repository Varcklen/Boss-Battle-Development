{
  "Id": 50332128,
  "Comment": "",
  "IsScript": true,
  "RunOnMapInit": false,
  "Script": "scope HeroesChoise initializer init\r\n\r\n    globals\r\n        unit array ChoosedHero[PLAYERS_LIMIT_ARRAYS]\r\n    \r\n        real Event_HeroChoose_Real = 0\r\n        unit Event_HeroChoose_Hero = null\r\n        \r\n        private FirstPosition tempPosition\r\n    endglobals\r\n    \r\n    struct FirstPosition\r\n        real x\r\n        real y\r\n        real facing\r\n    endstruct\r\n\r\n    private function Trig_HeroesChoise_Conditions takes nothing returns boolean\r\n        return IsUnitType(GetEnteringUnit(), UNIT_TYPE_HERO) and udg_hero[GetPlayerId(GetOwningPlayer(GetEnteringUnit())) + 1] == null\r\n    endfunction\r\n    \r\n    private function GetFirstPositon takes unit hero, integer index returns FirstPosition\r\n        if udg_Boss_LvL > 1 then\r\n            call SetHeroLevel( hero, GetHeroLevel(hero) + 1, true)\r\n            set tempPosition.x = GetLocationX( udg_point[index + 21] )\r\n            set tempPosition.y = GetLocationY( udg_point[index + 21] )\r\n            set tempPosition.facing = 90\r\n        else\r\n            set tempPosition.x = GetRectCenterX(gg_rct_HeroTp)\r\n            set tempPosition.y = GetRectCenterY(gg_rct_HeroTp)\r\n            set tempPosition.facing = 270\r\n        endif\r\n    \r\n        set hero = null\r\n        return tempPosition\r\n    endfunction\r\n\r\n    private function SetClassNumber takes unit hero returns nothing\r\n        local integer i = 1\r\n        local integer iEnd\r\n        local boolean isFind = false\r\n    \r\n        loop\r\n            exitwhen i > HeroesTableDatabase_CLASSES or isFind\r\n            if IsUnitHasAbility( hero, udg_DB_Hero_SpecAb[i] ) then\r\n                set udg_number[i + 100] = i\r\n                set isFind = true\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        if isFind == false then\r\n            set udg_number[i + 100] = 4\r\n        endif\r\n        \r\n        set i = 1\r\n        set iEnd = udg_Database_NumberItems[13]\r\n        loop\r\n            exitwhen i > iEnd\r\n            if IsUnitHasAbility( hero, udg_DB_Hero_SpecAb[i] ) then\r\n                call NewUniques( hero, udg_DB_Hero_SpecAb[i] )\r\n                set i = iEnd\r\n            endif\r\n            set i = i + 1\r\n        endloop\r\n        \r\n        set hero = null\r\n    endfunction\r\n    \r\n    private function AddBonusItems takes unit hero, integer index returns nothing\r\n        local integer unitType = GetUnitTypeId(hero)\r\n    \r\n        call UnitAddItem(hero, CreateItem('I054', GetUnitX(hero), GetUnitY(hero)))\r\n        if udg_logic[8] then\r\n            call UnitAddItem(hero, CreateItem('I056', GetUnitX(hero), GetUnitY(hero)))\r\n            set udg_logic[8] = false\r\n        elseif unitType == udg_HeroBonusPotionHero[1] or unitType == udg_HeroBonusPotionHero[2] or unitType == udg_HeroBonusPotionHero[3] or unitType == udg_HeroBonusPotionHero[4] then\r\n            call UnitAddItem(hero, CreateItem('I05B', GetUnitX(hero), GetUnitY(hero)))\r\n        endif\r\n        if udg_LvL[index] >= 15 then\r\n            call UnitAddItem(hero, CreateItem('I055', GetUnitX(hero), GetUnitY(hero)))\r\n        endif\r\n        if udg_LvL[index] >= 20 then\r\n            call UnitAddItem(hero, CreateItem('I0CX', GetUnitX(hero), GetUnitY(hero)))\r\n        endif\r\n    \r\n        set hero = null\r\n    endfunction\r\n    \r\n    private function IsTimerResume takes nothing returns boolean\r\n        local integer i\r\n        \r\n        if IsSinglePlayer or udg_Boss_LvL == 1 then\r\n            return false\r\n        endif\r\n        set i = 1\r\n        loop\r\n            exitwhen i > PLAYERS_LIMIT\r\n            if udg_hero[i] == null and GetPlayerSlotState(Player(i-1)) != PLAYER_SLOT_STATE_PLAYING then\r\n                return false\r\n            endif\r\n            set i= i + 1\r\n        endloop \r\n        return true\r\n    endfunction\r\n\r\n    private function HeroPicked takes nothing returns nothing\r\n        local unit hero = Event_HeroPicked_Hero\r\n        local player owner = Event_HeroPicked_Player\r\n        local integer index = GetPlayerId(owner) + 1\r\n        local integer heroKey = Event_HeroPicked_HeroKey\r\n        local integer class = Event_HeroPicked_Class\r\n        local FirstPosition position\r\n        \r\n        set udg_HeroNum[index] = heroKey\r\n        set udg_UnitHeroLogic[heroKey] = true\r\n        set udg_hero[index] = hero\r\n        set ChoosedHero[index] = hero\r\n        set position = GetFirstPositon(hero, index)\r\n        set udg_UnitHero[heroKey] = hero\r\n        set udg_number[index + 100] = class + 1\r\n        \r\n        call MultiSetIcon( udg_multi, ( udg_Multiboard_Position[index] * 3 ) - 1, 3, udg_DB_Hero_Icon[heroKey] )\r\n        if udg_SkinUsed[index] == 0 then\r\n            call BlzFrameSetTexture( faceframe[index], udg_DB_Hero_Icon[heroKey], 0, false)\r\n        endif \r\n        call SetUnitOwner( hero, owner, true )\r\n        call MMD_UpdateValueString(\"hero\",owner,GetUnitName(hero))\r\n        call SetUnitUserData(hero, index)\r\n        call SetClassNumber(hero)\r\n        call GroupAddUnit( udg_otryad, hero )\r\n        call GroupAddUnit( udg_heroinfo, hero )\r\n        call FogModifierStop( udg_Visible[index] )\r\n        call AddBonusItems(hero, index)\r\n        if IsTimerResume() then\r\n            call ResumeTimer(udg_timer[1])\r\n            call ResumeTimer(udg_timer[3])\r\n        endif \r\n\r\n        set Event_HeroChoose_Hero = hero\r\n        set Event_HeroChoose_Real = 0.00\r\n        set Event_HeroChoose_Real = 1.00\r\n        set Event_HeroChoose_Real = 0.00\r\n        \r\n        if GetLocalPlayer() == owner then\r\n            call ResetToGameCameraForPlayer( owner, 0 )\r\n            if AnyHasLvL(2) then\r\n                call BlzFrameSetVisible( modesbut, true )\r\n                if owner == udg_Host then\r\n                    call BlzFrameSetVisible( modeslight, true )\r\n                endif\r\n                if AnyHasLvL(10) == false then\r\n                    call BlzFrameSetVisible( modebase, false )\r\n                    call BlzFrameSetVisible( rotbase, false )\r\n                endif\r\n            endif\r\n            if udg_LvL[index] <= 5 then\r\n                call BlzFrameSetVisible( arrowframe, true )\r\n            endif\r\n            if not(udg_logic[77]) and not(udg_logic[9]) then\r\n                call BlzFrameSetVisible( rpkmod,true)\r\n            endif\r\n            call BlzFrameSetVisible( fon,true)\r\n            call BlzFrameSetVisible( butbk,true)\r\n            call BlzFrameSetVisible( iconframe[1],true)\r\n            call BlzFrameSetVisible( iconframe[2],true)\r\n            call BlzFrameSetVisible( iconframe[3],true)\r\n            call BlzFrameSetVisible( iconframe[4],true)\r\n            if GetPlayerSlotState( Player( 0 ) ) == PLAYER_SLOT_STATE_PLAYING then\r\n                call BlzFrameSetVisible( faceframe[1],true)\r\n            endif\r\n            if GetPlayerSlotState( Player( 1 ) ) == PLAYER_SLOT_STATE_PLAYING then\r\n                call BlzFrameSetVisible( faceframe[2],true)\r\n            endif\r\n            if GetPlayerSlotState( Player( 2 ) ) == PLAYER_SLOT_STATE_PLAYING then\r\n                call BlzFrameSetVisible( faceframe[3],true)\r\n            endif\r\n            if GetPlayerSlotState( Player( 3 ) ) == PLAYER_SLOT_STATE_PLAYING then\r\n                call BlzFrameSetVisible( faceframe[4],true)\r\n            endif\r\n            call SetCameraField(CAMERA_FIELD_TARGET_DISTANCE, 2225, 0)\r\n        endif\r\n        if udg_number[index + 100] == 7 then\r\n            call spdst( hero, 10 )\r\n        elseif udg_number[index + 100] == 5 then\r\n        \tcall luckyst( hero, 5 )\r\n        endif\r\n\r\n        call SetUnitPosition( hero, position.x, position.y )\r\n        call SetUnitFacing( hero, position.facing )\r\n        call PanCameraToTimedForPlayer( Player( GetPlayerId(GetOwningPlayer( hero ) ) ), position.x, position.y, 0 )\r\n        \r\n        if udg_combatlogic[index] == false and udg_Boss_LvL == 1 then\r\n            call KillUnit( hero )\r\n        endif\r\n        call SetUnitState( hero, UNIT_STATE_MANA, GetUnitState( hero, UNIT_STATE_MAX_MANA ) )\r\n        \r\n        call position.destroy()\r\n        set hero = null\r\n        set owner = null\r\n    endfunction\r\n\r\n    //===========================================================================\r\n    private function init takes nothing returns nothing\r\n        local integer i = 1\r\n        loop\r\n            exitwhen i > PLAYERS_LIMIT\r\n            set ChoosedHero[i] = null\r\n            set i = i + 1\r\n        endloop\r\n        call CreateEventTrigger( \"Event_HeroPicked_Real\", function HeroPicked, null )\r\n        \r\n        set tempPosition = FirstPosition.create()\r\n    endfunction\r\n\r\nendscope",
  "Events": [],
  "LocalVariables": [],
  "Conditions": [],
  "Actions": []
}